#########################
#
# Test functions for phase 0
#
#########################
setup_requirements()
{
	local host=$1
	echo "Setting up needed packages on $host"

	PACKAGE_LIST="opensm infiniband-diags rdma-ndd libibverbs-utils srp_daemon fabtests "
	PACKAGE_LIST+="mpitests-mvapich2 mpitests-openmpi2 mpitests-mpich "
	PACKAGE_LIST+="ibutils dapl-utils psmisc nfs-kernel-server "
	PACKAGE_LIST+="nvme-cli nvmetcli "

	case $(get_suse_version $host) in
		15)
			PACKAGE_LIST+="$PACKAGE_LIST python3-targetcli-fb "
		;;
		42.3|12.3)
			PACKAGE_LIST="$PACKAGE_LIST mpitests-openmpi targetcli-fb "
		;;
	esac
	tp $host "zypper install --no-confirm $PACKAGE_LIST"

}

kill_opensm()
{
	local host=$1
	tp $host 'killall opensm || true; sleep 1; killall -9 opensm || true';
}
reset_all_ports()
{
	local host=$1

	tp $host 'for port_guid in $(ibstat -p); do
	   		 	   ibportstate -G $port_guid reset;
			   done'
}

firewall_down()
{
	# Take down the firewall as some tests requires more than SSH port to be open (openMPI, NFSoRDMA, etc.)
	local host=$1
	tp $host 'iptables -P INPUT ACCEPT && iptables --flush'
}
